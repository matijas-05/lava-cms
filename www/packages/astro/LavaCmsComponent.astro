---
import type { LavaCms } from "@lavacms/core";
import camelcase from "camelcase";
// eslint-disable-next-line import/no-unresolved
import astroComponents from "virtual:lavacms-components";
// eslint-disable-next-line import/no-unresolved
import config from "virtual:lavacms-config";
import FallbackComponent from "./FallbackComponent.astro";

interface Props {
	component: LavaCms.Component;
}

const { component: cmsComponent } = Astro.props;

if (!cmsComponent) {
	throw new Error("No component data provided to `LavaCmsComponent` Astro component");
}
if (typeof cmsComponent.name !== "string") {
	throw new Error(
		`The CMS component you passed to \`LavaCmsComponent\` is invalid:\n${JSON.stringify(
			cmsComponent,
			null,
			2
		)}`
	);
}

const name = camelcase(cmsComponent.name);
// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
const Comp = astroComponents[name];
if (!(name in astroComponents) && !config.enableFallbackComponent) {
	throw new Error(`No Astro component found for CMS component \`${cmsComponent.name}\``);
}
---

{!Comp ? <FallbackComponent name={cmsComponent.name} /> : <Comp cms={cmsComponent.data} />}
